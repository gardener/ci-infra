periodics:
- name: ci-prow-label-sync
  cron: "17 * * * *"  # Every hour at 17 minutes past the hour
  cluster: gardener-prow-trusted
  labels:
    app: label-sync
  decorate: true
  extra_refs:
  - org: gardener
    repo: ci-infra
    base_ref: master
  reporter_config:
    slack:
      channel: "gardener-prow-alerts"
  annotations:
    description: Runs label_sync to synchronize GitHub repo labels with the label config defined in config/prow/labels.yaml
  spec:
    containers:
    - image: gcr.io/k8s-prow/label_sync:v20211214-938f24ffd3
      command:
      - /app/label_sync/app.binary
      args:
      - --config=config/prow/labels.yaml
      - --confirm=true
      - --only=gardener/ci-infra
      - --endpoint=http://ghproxy.prow.svc
      - --endpoint=https://api.github.com
      # TODO: switch to GitHub App Auth, once it's implemented in label_sync
      # see https://github.com/kubernetes/test-infra/issues/24143
      - --token=/etc/github/token
      - --debug
      volumeMounts:
      - name: github-token
        mountPath: /etc/github
        readOnly: true
    volumes:
    - name: github-token
      secret:
        secretName: github-token

- cron: "54 * * * *"  # Every hour at 54 minutes past the hour
  name: ci-prow-branchprotector
  cluster: gardener-prow-trusted
  decorate: true
  decoration_config:
    timeout: 5h
  extra_refs:
  - org: gardener
    repo: ci-infra
    base_ref: master
  annotations:
    description: Runs Prow's branchprotector to apply configured GitHub status context requirements and merge policies
  labels:
    app: branchprotector
  spec:
    containers:
    - image: gcr.io/k8s-prow/branchprotector:v20211214-938f24ffd3
      command:
      - /app/prow/cmd/branchprotector/app.binary
      args:
      - --config-path=config/prow/config.yaml
      - --confirm
      - --job-config-path=config/jobs
      - --github-endpoint=http://ghproxy.prow.svc
      - --github-endpoint=https://api.github.com
      - --github-token-path=/etc/github/token
      volumeMounts:
      - name: github-token
        mountPath: /etc/github
        readOnly: true
    volumes:
    - name: github-token
      secret:
        secretName: github-token

- cron: "30 * * * 1-5"
  name: ci-prow-autobump
  cluster: gardener-prow-trusted
  decorate: true
  extra_refs:
  - org: gardener
    repo: ci-infra
    base_ref: master
  reporter_config:
    slack:
      channel: "gardener-prow-alerts"
  annotations:
    description: Runs autobumper to create/update a PR that bumps prow images to the latest published version
  spec:
    containers:
    - image: gcr.io/k8s-prow/generic-autobumper:v20211214-938f24ffd3
      command:
      - /app/prow/cmd/generic-autobumper/app.binary
      args:
      - --config=config/prow/autobump-config/prow-component-autobump-config.yaml
      - --labels-override=kind/enhancement
      volumeMounts:
      - name: github-token
        mountPath: /etc/github-token
        readOnly: true
    volumes:
    - name: github-token
      secret:
        secretName: github-token

- cron: "45 * * * 1-5"
  name: ci-prow-autobump-jobs
  cluster: gardener-prow-trusted
  decorate: true
  extra_refs:
  - org: gardener
    repo: ci-infra
    base_ref: master
  reporter_config:
    slack:
      channel: "gardener-prow-alerts"
  annotations:
    description: Runs autobumper to create/update a PR that bumps prowjob images to latest published version
  spec:
    containers:
    - image: gcr.io/k8s-prow/generic-autobumper:v20211214-938f24ffd3
      command:
      - /app/prow/cmd/generic-autobumper/app.binary
      args:
      - --config=config/prow/autobump-config/prow-job-autobump-config.yaml
      - --labels-override=kind/enhancement
      volumeMounts:
      - name: github-token
        mountPath: /etc/github-token
        readOnly: true
    volumes:
    - name: github-token
      secret:
        secretName: github-token
